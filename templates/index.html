<<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Gerador de Or√ßamentos</title>
    <!--<style>
        body { font-family: Arial, sans-serif; margin: 2em; background-color: #f4f4f9; }
        .container { max-width: 700px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; }
        label { display: block; margin-top: 1em; margin-bottom: 0.5em; font-weight: bold; }
        input[type="text"], textarea { width: 100%; padding: 0.8em; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        textarea { resize: vertical; }
        button { display: block; width: 100%; padding: 1em; background-color: #007BFF; color: white; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer; margin-top: 2em; }
        button:hover { background-color: #0056b3; }
    </style> -->
</head>
<body>
    <div class="container">
        <h1>Gerador de Or√ßamentos</h1>
        <h2>{{ empresa.nome }}</h2>

        <form action="/verificar" method="post">
            <label for="cliente_nome">Nome do Cliente:</label>
            <input type="text" id="cliente_nome" name="cliente_nome" required>

            <label for="data_orcamento">Data do Or√ßamento:</label>
            <input type="text" id="data_orcamento" name="data_orcamento" value="{{ data_hoje }}" required>

        <div class="label-com-botao">
            <label for="servicos_inclusos">Servi√ßos Inclusos (um por linha):</label>
            <button type="button" id="btn-mic" title="Usar ditado por voz">üé§</button>
        </div>
            <small class="mic-instruction">Ou clique no microfone para falar</small>
            <textarea id="servicos_inclusos" name="servicos_inclusos" rows="6" required placeholder="Ex: Instala√ß√£o do motor principal&#10;Manuten√ß√£o do sistema de refrigera√ß√£o"></textarea>

            <label for="valor_total">Valor Total (R$):</label>
            <input type="text" id="valor_total" name="valor_total" placeholder="Ex: 1500,00" required>

            <label for="forma_pagamento">Forma de Pagamento:</label>
            <input type="text" id="forma_pagamento" name="forma_pagamento" value="A combinar" required>

            <button type="submit">Verificar e Gerar Or√ßamento (.docx)</button>
        </form>
    </div>
    <script>
    // Verifica se o navegador suporta a Web Speech API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const micButton = document.getElementById('btn-mic');
    const servicesTextarea = document.getElementById('servicos_inclusos');

    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        let isRecognizing = false;

        // Configura√ß√µes do reconhecimento de voz
        recognition.continuous = true; // Permite falar continuamente
        recognition.lang = 'pt-BR';    // Define o idioma para Portugu√™s do Brasil
        recognition.interimResults = true; // Mostra resultados parciais enquanto voc√™ fala

        // Evento de clique no bot√£o do microfone
        micButton.addEventListener('click', () => {
            if (!isRecognizing) {
                recognition.start();
            } else {
                recognition.stop();
            }
        });

        // Quando o reconhecimento come√ßa
        recognition.onstart = () => {
            isRecognizing = true;
            micButton.textContent = 'üî¥'; // Muda o √≠cone para indicar que est√° gravando
            micButton.classList.add('recording');
            console.log('Reconhecimento de voz iniciado.');
        };

        // Quando o reconhecimento termina
        recognition.onend = () => {
            isRecognizing = false;
            micButton.textContent = 'üé§'; // Volta ao √≠cone original
            micButton.classList.remove('recording');
            console.log('Reconhecimento de voz terminado.');
        };

        // Quando um erro acontece
        recognition.onerror = (event) => {
            console.error('Erro no reconhecimento de voz:', event.error);
            // Se o erro for 'no-speech', apenas paramos sem fazer nada.
            if (event.error !== 'no-speech') {
                alert(`Erro no reconhecimento de voz: ${event.error}`);
            }
        };

        let finalTranscript = servicesTextarea.value;

        // Quando o navegador captura alguma fala
        recognition.onresult = (event) => {
            let interimTranscript = '';
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    // Adiciona o resultado final ao texto, com a primeira letra mai√∫scula
                    let newSentence = event.results[i][0].transcript.trim();
                    finalTranscript += (finalTranscript ? '\n' : '') + newSentence.charAt(0).toUpperCase() + newSentence.slice(1);
                } else {
                    interimTranscript += event.results[i][0].transcript;
                }
            }
            // Atualiza a textarea com o resultado final + o resultado parcial
            servicesTextarea.value = finalTranscript + (interimTranscript ? '\n' + interimTranscript : '');
        };

    } else {
        // Se o navegador n√£o suportar a API, esconde o bot√£o
        console.log('Este navegador n√£o suporta a Web Speech API.');
        micButton.style.display = 'none';
    }
</script>
</body>
</html>